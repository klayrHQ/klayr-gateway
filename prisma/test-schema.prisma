// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

model NextBlockToSync {
  id     Int @id @unique
  height Int
}

model Block {
  height                Int      @id @unique
  id                    String   @unique
  version               Int
  timestamp             Int
  previousBlockID       String
  stateRoot             String
  assetRoot             String
  eventRoot             String
  transactionRoot       String
  validatorsHash        String
  generatorAddress      String
  maxHeightPrevoted     Int
  maxHeightGenerated    Int
  impliesMaxPrevotes    Boolean
  signature             String
  aggregateCommit       AggregateCommit?
  assets                Asset[] 
  transactions          Transaction[]
}


model AggregateCommit {
  id                   Int      @id @default(autoincrement())
  height               Int     
  aggregationBits      String
  certificateSignature String
  block                Block    @relation(fields: [blockHeight], references: [height])
  blockHeight          Int      @unique
}

// TODO: Most efficient?
model Asset {
  id        Int     @id @default(autoincrement())
  height    Int     
  module    String
  data      String
  block     Block   @relation(fields: [height], references: [height])
}

model Transaction {
  id               Int      @id @default(autoincrement())
  module           String
  command          String
  nonce            String
  fee              String
  senderPublicKey  String
  params           String
  // signatures       String[]   // SHOULD BE ARRAY but not supported for sqlite
  block            Block    @relation(fields: [blockHeight], references: [height])
  blockHeight      Int      @unique
}



generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./db/test.db"
}
